name: Publish Python Package

on: [push]
  # release:
  #   types: [created]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.8", "3.9", "3.10", "3.11"]
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
        cache: pip
        cache-dependency-path: '**/pyproject.toml'
    - name: Install dependencies
      run: |
        pip install -e .
        pip install pytest
    - name: Run tests
      env:
        RESOURCE_GROUPS: ${{ secrets.RESOURCE_GROUPS }}
        PUDL_DB: ${{ secrets.PUDL_DB }}
        PG_DB: ${{ secrets.PG_DB }}
      run: |
        pytest
#   deploy:
#     runs-on: ubuntu-latest
#     needs: [test]
#     environment: release
#     permissions:
#       id-token: write
#     steps:
#     - uses: actions/checkout@v4
#     - name: Set up Python
#       uses: actions/setup-python@v5
#       with:
#         python-version: '3.11'
#         cache: pip
#         cache-dependency-path: '**/pyproject.toml'
#     - name: Install dependencies
#       run: |
#         pip install setuptools wheel build
#     - name: Build
#       run: |
#         python -m build
#     - name: Publish
#       uses: pypa/gh-action-pypi-publish@release/v1